# React Refactoring - Complete Plan & Progress

## Branch: `refactor/react-frontend`

---

## âœ… COMPLETED - Phase 2a: Foundation Setup

### What We've Built

1. **React + Vite Architecture**
   ```
   datasets/
   â”œâ”€â”€ src/
   â”‚   â”œâ”€â”€ components/
   â”‚   â”‚   â”œâ”€â”€ WorldMap.jsx     âœ… Observable Plot (from evals pattern)
   â”‚   â”‚   â””â”€â”€ Header.jsx       âœ… Navigation with routing
   â”‚   â”œâ”€â”€ pages/
   â”‚   â”‚   â”œâ”€â”€ InsightsPage.jsx âœ… Fully functional
   â”‚   â”‚   â””â”€â”€ CatalogPage.jsx  âš ï¸  Placeholder
   â”‚   â”œâ”€â”€ styles/
   â”‚   â”‚   â”œâ”€â”€ main.css         âœ… Extracted from original
   â”‚   â”‚   â””â”€â”€ insights.css     âœ… Additional styles
   â”‚   â”œâ”€â”€ App.jsx              âœ… Router setup
   â”‚   â””â”€â”€ main.jsx             âœ… Entry point
   â”‚
   â”œâ”€â”€ public/
   â”‚   â”œâ”€â”€ data/
   â”‚   â”‚   â””â”€â”€ insights.json    âœ… Generated by Python
   â”‚   â””â”€â”€ img/                 âœ… All logos/assets
   â”‚
   â”œâ”€â”€ scripts/
   â”‚   â””â”€â”€ generate_insights_data.py  âœ… JSON generator
   â”‚
   â”œâ”€â”€ package.json             âœ… Dependencies defined
   â”œâ”€â”€ vite.config.js           âœ… GitHub Pages config
   â””â”€â”€ index.html               âœ… Entry template
   ```

2. **Build System**
   - âœ… `npm run dev` - Development server with hot reload
   - âœ… `npm run build` - Builds to `docs/` for GitHub Pages
   - âœ… `npm run preview` - Preview production build
   - âœ… Successfully built and tested

3. **Data Flow**
   ```
   Google Sheets â†’ Python (xlsx) â†’ Python (insights.json) â†’ React â†’ Vite build â†’ docs/
   ```

---

## ğŸ¯ NEXT STEPS - Phase 2b: Complete Migration

### Step 1: Extract Full Styles âš ï¸ IN PROGRESS

**Issue:** CSS extraction has some HTML remnants  
**Fix needed:** Clean up `src/styles/main.css`

```bash
# Extract just the CSS properly
# Remove any HTML tags that got included
```

### Step 2: Create Catalog Data Generator

**New file:** `scripts/generate_catalog_data.py`

```python
def generate_catalog_json():
    """
    Read data_catalog.xlsx
    Output: public/data/catalog.json
    
    Structure:
    {
      "projects": [...],
      "filters": {
        "sdgs": [...],
        "countries": [...],
        "data_types": [...]
      },
      "stats": {
        "total_projects": 60,
        "total_datasets": 80,
        "total_usecases": 45,
        "total_countries": 21
      }
    }
    """
```

### Step 3: Build Catalog Components

**Components needed:**

1. **ProjectCard.jsx**
   ```jsx
   function ProjectCard({ project }) {
     return (
       <div className="card">
         <div className="card-header">
           <h3>{project.title}</h3>
           <img src={project.image} />
         </div>
         <div className="card-body">
           <p>{project.description}</p>
           <div className="tags">
             {project.sdgs.map(sdg => <span>{sdg}</span>)}
           </div>
         </div>
       </div>
     )
   }
   ```

2. **FilterBar.jsx**
   ```jsx
   function FilterBar({ onFilterChange, filters }) {
     return (
       <div className="filters">
         <SDGFilter />
         <CountryFilter />
         <DataTypeFilter />
         <SearchBar />
       </div>
     )
   }
   ```

3. **ProjectGrid.jsx**
   ```jsx
   function ProjectGrid({ projects, filters }) {
     const filtered = useFilteredProjects(projects, filters)
     return (
       <div className="grid">
         {filtered.map(p => <ProjectCard project={p} />)}
       </div>
     )
   }
   ```

4. **DetailPanel.jsx** (Side panel)
   ```jsx
   function DetailPanel({ project, onClose }) {
     return (
       <div className="side-panel">
         {/* Full project details */}
       </div>
     )
   }
   ```

### Step 4: Build Complete CatalogPage

**Structure:**
```jsx
function CatalogPage() {
  const [projects, setProjects] = useState([])
  const [filters, setFilters] = useState({})
  const [selectedProject, setSelectedProject] = useState(null)
  
  useEffect(() => {
    fetch('./data/catalog.json')
      .then(r => r.json())
      .then(setProjects)
  }, [])
  
  return (
    <>
      <Header />
      <CatalogHeader stats={stats} />
      <FilterBar filters={filters} onChange={setFilters} />
      <ProjectGrid projects={projects} filters={filters} />
      {selectedProject && <DetailPanel project={selectedProject} />}
    </>
  )
}
```

### Step 5: Port Interactive Features

1. **Theme Switcher**
   ```jsx
   function ThemeSwitcher() {
     const [theme, setTheme] = useState('classic')
     
     useEffect(() => {
       document.documentElement.setAttribute('data-theme', theme)
       localStorage.setItem('theme', theme)
     }, [theme])
     
     return <button onClick={() => setTheme(...)}>...</button>
   }
   ```

2. **Search Functionality**
   ```jsx
   function useSearch(projects, query) {
     return useMemo(() => 
       projects.filter(p => 
         p.title.toLowerCase().includes(query.toLowerCase())
       ), [projects, query])
   }
   ```

3. **Filter Logic**
   ```jsx
   function useFilters(projects, filters) {
     return useMemo(() => {
       let filtered = projects
       if (filters.sdg) filtered = filtered.filter(...)
       if (filters.country) filtered = filtered.filter(...)
       return filtered
     }, [projects, filters])
   }
   ```

### Step 6: Update Build Script

**Update:** `scripts/build_from_google_sheets.py`

```python
def build_complete_site():
    # 1. Fetch from Google Sheets â†’ xlsx
    fetch_from_google_sheets()
    
    # 2. Create project directories (markdown, images)
    create_project_directories(df)
    
    # 3. Generate JSON data files
    subprocess.run(['python', 'scripts/generate_catalog_data.py'])
    subprocess.run(['python', 'scripts/generate_insights_data.py', 
                    '--project-count', str(project_count)])
    
    # 4. Build React app
    subprocess.run(['npm', 'run', 'build'])
    
    print("âœ… Complete build finished!")
```

---

## ğŸ“‚ Project Folders - PRESERVED

**Important:** The existing project folder structure remains **exactly the same**:

```
docs/public/projects/{project_id}/
â”œâ”€â”€ {title}.txt              # Marker file
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ description.md       # â† Searchable content (future RAG)
â”‚   â”œâ”€â”€ data_characteristics.md
â”‚   â”œâ”€â”€ model_characteristics.md
â”‚   â””â”€â”€ how_to_use.md
â””â”€â”€ images/
    â””â”€â”€ *.jpg/png            # â† Project images
```

**Why this is important:**
- âœ… Images can be displayed in project cards
- âœ… Markdown files can be loaded for detail view
- âœ… Ready for RAG (semantic search across markdown)
- âœ… GitHub links to specific projects still work
- âœ… Nothing breaks in existing URLs

**How React accesses them:**
```jsx
// In ProjectCard component
<img src={`./public/projects/${project.id}/images/${project.image}`} />

// In DetailPanel component
fetch(`./public/projects/${project.id}/docs/description.md`)
  .then(r => r.text())
  .then(markdown => setContent(markdown))
```

---

## ğŸš€ Future RAG Integration (Ready for this!)

### Architecture

```
Build Time:
Python â†’ Generate embeddings â†’ public/data/embeddings.json

Runtime (Client-side):
User searches â†’ transformers.js â†’ Semantic search â†’ Show results
```

### Implementation (when ready)

```python
# scripts/generate_embeddings.py
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('all-MiniLM-L6-v2')

embeddings = {}
for project_id in projects:
    # Read all markdown from docs/public/projects/{id}/docs/
    content = read_all_markdown(project_id)
    vector = model.encode(content)
    embeddings[project_id] = vector.tolist()

# Save for client
save_json('public/data/embeddings.json', embeddings)
```

```jsx
// src/components/SemanticSearch.jsx
import { pipeline } from '@xenova/transformers'

function SemanticSearch() {
  const [results, setResults] = useState([])
  
  const search = async (query) => {
    const embedder = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2')
    const queryVector = await embedder(query)
    
    // Compare with pre-computed vectors
    const scores = computeSimilarity(queryVector, embeddings)
    setResults(topK(scores, 10))
  }
  
  return <SearchBar onSearch={search} results={results} />
}
```

**Benefits:**
- âœ… Runs entirely in browser (no backend!)
- âœ… Free on GitHub Pages
- âœ… Privacy-preserving
- âœ… Fast semantic search

---

## ğŸ“‹ Migration Checklist

### Completed âœ…
- [x] Create branch `refactor/react-frontend`
- [x] Set up package.json with dependencies
- [x] Configure vite.config.js for GitHub Pages
- [x] Create React entry point (main.jsx, App.jsx)
- [x] Create routing structure
- [x] Build WorldMap component (Observable Plot)
- [x] Build Header component
- [x] Build InsightsPage (fully functional)
- [x] Create generate_insights_data.py (JSON output)
- [x] Test build process (âœ… builds successfully)
- [x] Preserve project folders structure

### In Progress ğŸŸ¡
- [ ] Clean up CSS extraction (remove HTML remnants)
- [ ] Create catalog data generator
- [ ] Build ProjectCard component
- [ ] Build FilterBar component

### Pending â³
- [ ] Complete CatalogPage implementation
- [ ] Port theme switcher
- [ ] Port search functionality
- [ ] Port detail side panel
- [ ] Test all filters
- [ ] Test mobile responsive
- [ ] Update README with new build instructions

---

## ğŸ¨ Design Preservation Checklist

- âœ… Color scheme (CSS variables preserved)
- âœ… Typography (same fonts)
- âœ… Layout structure
- âœ… Header with logos
- âœ… Navigation styling
- âœ… Responsive breakpoints
- â³ Project cards (pending migration)
- â³ Filters (pending migration)
- â³ Side panel (pending migration)
- â³ Theme switcher (pending migration)

---

## ğŸ›  Development Workflow

### For Development

```bash
# Terminal 1: Auto-generate data on changes
cd /Users/jonas/github/datasets
python scripts/generate_insights_data.py --project-count 60

# Terminal 2: Run dev server
npm run dev
# Opens http://localhost:3000
# Hot reload on code changes
```

### For Production Build

```bash
# Complete build (Python + React)
python scripts/build_from_google_sheets.py  # When updated

# Or manually:
python scripts/generate_insights_data.py --project-count 60
npm run build
# Result: docs/ ready for GitHub Pages
```

### For Testing

```bash
# Preview production build locally
npm run preview
```

---

## ğŸ“Š Current Status

**Insights Page:** ğŸŸ¢ **FULLY WORKING**
- âœ… Observable Plot world map rendering
- âœ… Real data from insights.json
- âœ… Correct project count (60, matching front page)
- âœ… Interactive tooltips
- âœ… Responsive design
- âœ… Matching visual design

**Catalog Page:** ğŸŸ¡ **PLACEHOLDER** 
- âš ï¸ Shows "coming soon" message
- âš ï¸ Needs full implementation
- â³ Components to build: ProjectCard, FilterBar, DetailPanel

**Build Process:** ğŸŸ¢ **WORKING**
- âœ… Vite builds successfully
- âœ… Output to `docs/` correct
- âœ… GitHub Pages compatible
- âœ… Fast development server

---

## ğŸ¯ Next Immediate Steps

1. **Extract catalog data** (highest priority)
   - Create `generate_catalog_data.py`
   - Output `public/data/catalog.json`
   - Include all project metadata

2. **Build ProjectCard component**
   - Match exact current design
   - Include SDG tags, data type chips
   - Click handling for detail panel

3. **Build FilterBar**
   - SDG filter
   - Country filter
   - Data type filter
   - Search bar

4. **Complete CatalogPage**
   - Integrate all components
   - Add filtering logic
   - Add statistics animation
   - Add detail panel

---

## ğŸ”§ Technical Decisions Made

### 1. Why Vite?
- âš¡ **Fast**: Instant dev server, <50ms hot reload
- ğŸ¯ **Simple**: Minimal configuration
- ğŸ“¦ **Modern**: ES modules, tree-shaking
- ğŸŒ **GitHub Pages**: Easy deployment config

### 2. Why React?
- âœ… **Familiar**: You use it in evals-for-every-language
- âœ… **Component reuse**: Build once, use everywhere
- âœ… **Ecosystem**: Best libraries available
- âœ… **Future-ready**: Easy to add complex features (RAG, chat)
- âœ… **Maintainable**: Proper separation of concerns

### 3. HTML + React (not just JS)
- âœ… **Entry point**: Browser needs HTML to start
- âœ… **SEO**: Crawlers see HTML structure
- âœ… **JSX**: Much cleaner than `document.createElement()`
- âœ… **Standard**: How modern web apps work

**Example comparison:**

```javascript
// âŒ Pure JS - Painful
const card = document.createElement('div')
card.className = 'card'
const title = document.createElement('h3')
title.textContent = project.title
card.appendChild(title)
// ... 50 more lines
```

```jsx
// âœ… React JSX - Clean
function ProjectCard({ project }) {
  return (
    <div className="card">
      <h3>{project.title}</h3>
      <p>{project.description}</p>
    </div>
  )
}
```

### 4. Data Architecture

**Before:** Python generates entire HTML

**After:** 
- Python generates JSON data only
- React consumes JSON and renders UI
- Clean separation of concerns

**Benefits:**
- âœ… Python focuses on data extraction/transformation
- âœ… JavaScript focuses on UI/interactions
- âœ… JSON can be reused (API, other tools, RAG)
- âœ… Much easier to maintain and test

---

## ğŸ“¦ Dependencies Explained

```json
{
  "react": "^18.3.1",              // UI framework
  "react-dom": "^18.3.1",          // React â†’ HTML rendering
  "react-router-dom": "^6.22.0",   // Routing (catalog / insights)
  "@observablehq/plot": "^0.6.15", // Maps & visualizations
  "topojson-client": "^3.1.0",     // Convert map topology data
  "vite": "^5.1.6",                // Build tool
  "@vitejs/plugin-react": "^4.2.1" // React support for Vite
}
```

**Total size:** ~413KB bundled (gzipped: ~139KB)  
**No backend needed:** All runs client-side  
**GitHub Pages:** âœ… Fully compatible

---

## ğŸ¨ Design Preservation Strategy

### CSS Approach

**Current:** All CSS in Python strings (3000+ lines)

**New:** Proper CSS files
```
src/styles/
â”œâ”€â”€ main.css        # Core styles (extracted from original)
â”œâ”€â”€ catalog.css     # Catalog-specific
â”œâ”€â”€ insights.css    # Insights-specific
â””â”€â”€ components.css  # Reusable component styles
```

### Component Styling

**Option 1:** CSS classes (current approach)
```jsx
<div className="card">...</div>
```

**Option 2:** CSS modules (if needed later)
```jsx
import styles from './Card.module.css'
<div className={styles.card}>...</div>
```

**Decision:** Stick with CSS classes for now (simpler, matches original)

---

## ğŸš€ Deployment (GitHub Pages)

**Current URL:** `https://{username}.github.io/datasets/`

**Build output:**
```
docs/
â”œâ”€â”€ index.html           # Entry point (Vite-generated)
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ index.js        # Bundled React app
â”‚   â””â”€â”€ index.css       # Bundled styles
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ catalog.json    # Python-generated
â”‚   â””â”€â”€ insights.json   # Python-generated
â””â”€â”€ public/
    â””â”€â”€ projects/       # Python-generated (preserved!)
```

**GitHub Pages config:**
- Source: `docs/` folder (already configured)
- No changes needed to GitHub Pages settings
- Vite outputs to `docs/` automatically

---

## ğŸ§ª Testing Plan

### Manual Testing

1. **Insights Page**
   - [x] World map loads
   - [x] Correct country data
   - [x] Tooltips work
   - [x] Mobile responsive
   - [x] Navigation works

2. **Catalog Page** (when complete)
   - [ ] All projects display
   - [ ] Filters work (SDG, country, data type)
   - [ ] Search works
   - [ ] Cards clickable
   - [ ] Detail panel opens
   - [ ] Statistics count up animation
   - [ ] Mobile responsive

3. **Cross-cutting**
   - [ ] Theme switcher works
   - [ ] Navigation between pages
   - [ ] Back button works
   - [ ] URLs work correctly

### Automated Testing (future)

```bash
npm install --save-dev vitest @testing-library/react

# Test components
npm run test
```

---

## ğŸ’¾ Current Files Status

### New Files (React)
- âœ… `package.json` - Dependencies
- âœ… `vite.config.js` - Build config
- âœ… `index.html` - Entry template
- âœ… `src/main.jsx` - React entry
- âœ… `src/App.jsx` - Router
- âœ… `src/components/WorldMap.jsx` - Map visualization
- âœ… `src/components/Header.jsx` - Navigation
- âœ… `src/pages/InsightsPage.jsx` - Complete
- âœ… `src/pages/CatalogPage.jsx` - Placeholder
- âœ… `src/styles/*.css` - Styles

### New Files (Python)
- âœ… `scripts/generate_insights_data.py` - JSON generator
- â³ `scripts/generate_catalog_data.py` - TODO

### Modified Files
- âœ… `scripts/generate_catalog.py` - Added insights link (still HTML generator)
- âœ… `scripts/build_from_google_sheets.py` - Minor updates
- â³ Will be replaced by new build script

### Preserved Files
- âœ… `docs/public/projects/**` - All project folders intact
- âœ… `scripts/utils.py` - Utility functions reused
- âœ… `requirements.txt` - Python dependencies

---

## ğŸ“ Learning from evals-for-every-language

### What We Adopted

1. **Component Pattern**
   ```jsx
   // Same pattern as your WorldMap.js
   const Component = ({ data }) => {
     const ref = useRef()
     const [state, setState] = useState()
     
     useEffect(() => {
       // Fetch data
     }, [])
     
     useEffect(() => {
       // Render visualization
       const plot = Plot.plot({...})
       ref.current.appendChild(plot)
       return () => plot.remove() // Cleanup
     }, [state, data])
     
     return <div ref={ref} />
   }
   ```

2. **Directory Structure**
   ```
   src/
   â”œâ”€â”€ components/  â† Reusable pieces
   â”œâ”€â”€ pages/       â† Full pages
   â””â”€â”€ styles/      â† CSS files
   ```

3. **Observable Plot Integration**
   - Direct import: `import * as Plot from '@observablehq/plot'`
   - Ref-based rendering
   - Proper cleanup in useEffect return

### What We Adapted

- **Data source:** Static JSON instead of API calls
- **Build target:** `docs/` for GitHub Pages
- **No backend:** Everything pre-computed
- **Relative paths:** For GitHub Pages compatibility

---

## ğŸ¯ Success Criteria

**The refactored version must:**

- âœ… Look identical to current site
- âœ… All features work (filters, search, detail view)
- âœ… Faster development experience
- âœ… Easier to maintain
- âœ… Ready for RAG integration
- âœ… Still free (GitHub Pages)
- âœ… One-command build
- âœ… Project folders preserved
- âœ… Existing URLs don't break

---

## ğŸ“ Questions for User

Before continuing with Catalog page implementation, please confirm:

1. **CSS Organization:** 
   - Keep all CSS in one file (`main.css`)?
   - Or split into component-specific files?

2. **Theme Switcher:**
   - Port exact current behavior (Classic â†” Solarized)?
   - Or simplify?

3. **Detail Panel:**
   - Keep as slide-out side panel?
   - Or make it a modal/overlay?

4. **Priority Order:**
   - Build catalog page fully before testing?
   - Or build incrementally and test each component?

---

**Current Status:** ğŸŸ¢ Foundation complete, ready for catalog implementation  
**Estimated Remaining:** 2-3 hours for complete catalog page  
**Risk Level:** Low - architecture proven, clear path forward


